(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{24654:function(){},31070:function(e,t,r){Promise.resolve().then(r.bind(r,26273))},94508:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(61994),s=r(53335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}},26273:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(57437),s=r(2265);let a=(0,r(79205).Z)("gallery-vertical-end",[["path",{d:"M7 2h10",key:"nczekb"}],["path",{d:"M5 6h14",key:"u2x4p"}],["rect",{width:"18",height:"12",x:"3",y:"10",rx:"2",key:"l0tzu3"}]]);var i=r(94508),o=r(28207),c=r(99376),l=r(43310),u=r(20423),d=()=>{let{token:e,isTokenExpired:t,login:r,isLoading:a,getTokenFromRequest:i}=(0,o.a)(),d=(0,c.useRouter)(),f=(0,c.useSearchParams)(),p=f.get("code"),{codeVerifier:h}=(0,l.f)(),[m,g]=(0,s.useState)(!1),v=f.get("redirect")||"/";return(0,s.useEffect)(()=>{!p||a||void 0===h||m||(g(!0),r(p,()=>{d.replace(v)}))},[p,a,h,r,d,m,v]),null===e||t()||d.replace(v),(0,n.jsx)(u.f,{isLoading:a,onClick:function(e){e.preventDefault(),i()},className:"w-full py-6 text-lg",children:"Se connecter avec MyECL"})};function f(e){let{className:t,...r}=e,s=(0,c.useRouter)();return(0,n.jsxs)("form",{className:(0,i.cn)("flex flex-col gap-12",t),...r,children:[(0,n.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Se connecter"}),(0,n.jsx)("p",{className:"text-muted-foreground text-balance text-lg max-w-md",children:"Si vous poss\xe9dez d\xe9j\xe0 un compte MyECL, vous pouvez vous connecter avec."})]}),(0,n.jsx)("div",{className:"grid gap-8",children:(0,n.jsx)(d,{})}),(0,n.jsxs)("div",{className:"text-center text-base",children:["Vous n'avez pas de compte ?"," ",(0,n.jsx)("button",{onClick:()=>{s.push("/calypsso/register?external=true")},className:"underline underline-offset-4 font-medium text-primary hover:text-primary/80",children:"Cr\xe9er un compte"})]})]})}var p=()=>(0,n.jsxs)("div",{className:"grid min-h-svh lg:grid-cols-2",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-8 p-6 md:p-10",children:[(0,n.jsx)("div",{className:"flex justify-center gap-2 md:justify-start",children:(0,n.jsxs)("a",{href:"#",className:"flex items-center gap-2 font-medium",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-md bg-primary text-primary-foreground",children:(0,n.jsx)(a,{className:"size-4"})}),"Challenger"]})}),(0,n.jsx)("div",{className:"flex flex-1 items-center justify-center py-12",children:(0,n.jsx)("div",{className:"w-full max-w-md",children:(0,n.jsx)(f,{})})})]}),(0,n.jsx)("div",{className:"relative hidden lg:block py-[3vh] pr-[3vh]",children:(0,n.jsx)("div",{className:"bg-muted h-full rounded-xl overflow-hidden"})})]})},20423:function(e,t,r){"use strict";r.d(t,{f:function(){return i}});var n=r(57437),s=r(12381),a=r(20653);let i=e=>{let{isLoading:t,type:r,onClick:i,children:o,className:c,disabled:l,variant:u="default",size:d="default"}=e;return(0,n.jsx)(s.z,{variant:u,type:r,onClick:i,className:c,disabled:t||l,size:d,children:t?(0,n.jsx)(a.BGW,{className:"h-4 w-4 animate-spin"}):o})}},12381:function(e,t,r){"use strict";r.d(t,{d:function(){return c},z:function(){return l}});var n=r(57437),s=r(2265),a=r(37053),i=r(90535),o=r(94508);let c=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:l=!1,...u}=e,d=l?a.g7:"button";return(0,n.jsx)(d,{className:(0,o.cn)(c({variant:s,size:i,className:r})),ref:t,...u})});l.displayName="Button"},18752:function(e,t,r){"use strict";r.d(t,{Am:function(){return d},pm:function(){return f}});var n=r(2265);let s=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?i(r):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],l={toasts:[]};function u(e){l=o(l,e),c.forEach(e=>{e(l)})}function d(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(l);return n.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},28207:function(e,t,r){"use strict";r.d(t,{a:function(){return x}});var n=r(2265),s=r(83464),a=r(64927),i=r(59625),o=r(89134);let c=(0,i.Ue)()((0,o.mW)((0,o.tJ)(e=>({token:null,refreshToken:null,userId:null,setToken:t=>{let r=t?JSON.parse(atob(t.split(".")[1])).sub:null;e({token:t,userId:r})},setRefreshToken:t=>{e({refreshToken:t})}}),{name:"token-storage"})));var l=r(99376),u=r(4461),d=r(92850),f=r(43310),p=r(18752);let h="RaidRegistering",m="".concat("https://challenger.myecl.fr","/login"),g="https://hyperion.myecl.fr",v=["API"],x=()=>{let e=(0,l.usePathname)(),[t,r]=(0,n.useState)(!1),{token:i,setToken:o,refreshToken:x,setRefreshToken:y,userId:b}=c(),{resetUser:_}=(0,u.L)(),[S,j]=(0,n.useState)(!1),T=(0,l.useRouter)(),{codeVerifier:k,setCodeVerifier:w,resetCodeVerifier:N}=(0,f.f)(),A=(0,n.useRef)(null);async function E(e){let t=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-256",t).then(e=>btoa(Array.from(new Uint8Array(e)).map(e=>String.fromCharCode(e)).join("")).replace(/\+/g,"-").replace(/\//g,"_"))}async function O(e){r(!0);let t=(0,a.stringify)(e);try{let e=await s.Z.post("".concat(g,"/auth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}});if(200!=e.status){r(!1),(0,p.Am)({title:"Erreur",description:"Une erreur est survenue lors de la connexion",variant:"destructive"});return}let n=e.data;r(!1),o(n.access_token),y(n.refresh_token)}catch(e){r(!1),M()&&R()}}async function C(){return t?null:(r(!0),x)?(await O({grant_type:"refresh_token",client_id:h,refresh_token:x}),x):null}function M(){return null===i||(i?JSON.parse(atob(i.split(".")[1])).exp:0)<Math.floor(Date.now()/1e3)-60}async function z(e,r){k&&!t&&(await O({grant_type:"authorization_code",client_id:h,code:e,redirect_uri:m,code_verifier:k}),j(!0),r&&r(),N())}async function I(){r(!0);let e=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,s=crypto.getRandomValues(new Uint8Array(128)),a=0;a<128;a++)t+=r.charAt(Math.floor(s[a]/128*n));return t}(128);w(e);let t="".concat(g,"/auth/authorize?client_id=").concat(h,"&response_type=code&scope=").concat(v.join(" "),"&redirect_uri=").concat(m,"&code_challenge=").concat(await E(e),"&code_challenge_method=S256");window.location.href=t}function R(){o(null),y(null),j(!1),T.replace("/login"),_()}async function D(){return t?null:(r(!0),null!==i?j(!0):"/login"!=e&&T.replace("/login?redirect=".concat(e)),r(!1),i)}return(0,d.a)({queryKey:["lookToRefreshToken"],queryFn:()=>(function(){if(A.current&&clearTimeout(A.current),null===i)return null;let e=(i?JSON.parse(atob(i.split(".")[1])).exp:0)*1e3-Date.now()-6e4;return e<=0?C():A.current=setTimeout(()=>{C(),A.current=null},e),i})(),retry:0,enabled:null!==i,refetchOnMount:!1}),(0,d.a)({queryKey:["getTokenFromStorage"],queryFn:()=>D(),retry:0,enabled:null===i,refetchOnMount:!1}),{getTokenFromRequest:I,isLoading:t,token:i,isTokenQueried:S,logout:R,userId:b,isTokenExpired:M,login:z}}},43310:function(e,t,r){"use strict";r.d(t,{f:function(){return a}});var n=r(59625),s=r(89134);let a=(0,n.Ue)()((0,s.mW)((0,s.tJ)(e=>({codeVerifier:void 0,setCodeVerifier:t=>{e({codeVerifier:t,isLoading:!0})},resetCodeVerifier:()=>{e({codeVerifier:void 0,isLoading:!1})},isLoading:!1}),{name:"raid-code-verifier-storage"})))},4461:function(e,t,r){"use strict";r.d(t,{L:function(){return a}});var n=r(59625),s=r(89134);let a=(0,n.Ue)()((0,s.mW)((0,s.tJ)(e=>({user:void 0,setUser:t=>{e({user:t})},resetUser:()=>{e({user:void 0})}}),{name:"raid-user-storage"})))}},function(e){e.O(0,[8310,1414,9522,2971,2117,1744],function(){return e(e.s=31070)}),_N_E=e.O()}]);