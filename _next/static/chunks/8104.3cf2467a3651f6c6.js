(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8104],{30401:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},83774:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},15868:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},18930:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},28104:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var n=t(57437),a=t(2265),s=t(34040);t(35046);var o=t(15868),i=t(83774),c=t(12381);function l(e){let{locationName:r,onClick:t,address:a,latitude:s,longitude:l}=e;return(0,n.jsxs)("div",{className:"relative",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,n.jsx)("div",{className:"w-[220px] bg-white rounded-lg shadow-lg border p-1.5",children:(0,n.jsxs)("div",{className:"text-center mb-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-0.5",children:[(0,n.jsx)("h3",{className:"font-medium text-base text-gray-900 truncate",children:r}),(0,n.jsx)(c.z,{size:"sm",onClick:e=>{e.preventDefault(),e.stopPropagation(),t()},className:"w-6 h-6 p-0",children:(0,n.jsx)(o.Z,{className:"h-3 w-3"})})]}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground truncate flex items-center justify-center gap-1",children:[(0,n.jsx)(i.Z,{className:"h-4 w-4"}),a||"".concat(s.toFixed(4),", ").concat(l.toFixed(4))]})]})}),(0,n.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2 -bottom-2",children:(0,n.jsx)("div",{className:"w-0 h-0 border-l-[12px] border-r-[12px] border-t-[12px] border-l-transparent border-r-transparent border-t-white drop-shadow-sm"})})]})}var d=t(69174),u=t(31593),m=t(40279),f=t(23675),x=t(80670),p=t(32489),h=t(30401),g=t(18930),v=t(94508);function b(e){let{isAdded:r,address:t,form:a,onSubmit:s,onCancel:o,isCreateLoading:l=!1,isUpdateLoading:b=!1,isDeleteLoading:j=!1,onDelete:N,editingLocation:y}=e,w=e=>{e.preventDefault(),e.stopPropagation(),a.trigger().then(()=>{a.handleSubmit(s)(e)})};return(0,n.jsxs)("div",{className:"relative",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,n.jsxs)("div",{className:"w-[400px] sm:w-[450px] bg-white rounded-lg shadow-lg border p-4",children:[(0,n.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,n.jsx)("div",{className:"bg-rose-500/10 p-2 rounded-full shrink-0",children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1 mb-2",children:[(0,n.jsx)("h3",{className:"font-medium text-base",children:y?"Modifier le lieu":"Nouveau lieu"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(d.C,{variant:"secondary",className:(0,v.cn)("text-xs",r?"border-red-500 text-red-600":"border-green-500 text-green-600"),children:r?"Existant":"Nouveau"}),(0,n.jsx)(c.z,{variant:"ghost",size:"sm",onClick:e=>{e.preventDefault(),e.stopPropagation(),o()},className:"h-6 w-6 p-0",children:(0,n.jsx)(p.Z,{className:"h-3 w-3"})})]})]}),t&&(0,n.jsxs)("p",{className:"text-sm text-muted-foreground truncate",children:[(0,n.jsx)(i.Z,{className:"h-3 w-3 inline mr-1 opacity-70"}),t]})]})]}),(0,n.jsx)(u.Z,{className:"mb-4"}),(0,n.jsx)(x.l0,{...a,children:(0,n.jsxs)("form",{onSubmit:w,className:"space-y-3",children:[(0,n.jsx)(x.Wi,{control:a.control,name:"name",render:e=>{let{field:r}=e;return(0,n.jsxs)(x.xJ,{children:[(0,n.jsx)(x.lX,{className:"text-sm",children:"Nom du lieu *"}),(0,n.jsx)(x.NI,{children:(0,n.jsx)(m.I,{placeholder:"Entrez le nom du lieu",...r,className:"h-8"})}),(0,n.jsx)(x.zG,{})]})}}),(0,n.jsx)(x.Wi,{control:a.control,name:"description",render:e=>{let{field:r}=e;return(0,n.jsxs)(x.xJ,{children:[(0,n.jsx)(x.lX,{className:"text-sm",children:"Description"}),(0,n.jsx)(x.NI,{children:(0,n.jsx)(f.g,{placeholder:"Entrez une description du lieu",...r,className:"h-16 resize-none"})}),(0,n.jsx)(x.zG,{})]})}}),(0,n.jsx)(x.Wi,{control:a.control,name:"address",render:e=>{let{field:r}=e;return(0,n.jsxs)(x.xJ,{children:[(0,n.jsx)(x.lX,{className:"text-sm",children:"Adresse"}),(0,n.jsx)(x.NI,{children:(0,n.jsx)(m.I,{placeholder:"Entrez l'adresse du lieu",...r,className:"h-8"})}),(0,n.jsx)(x.zG,{})]})}}),(0,n.jsx)(u.Z,{className:"my-3"}),(0,n.jsxs)("div",{className:"grid grid-cols-".concat(y?2:1," gap-2"),children:[(0,n.jsxs)(c.z,{disabled:l||b,className:"flex items-center justify-center",onClick:w,children:[(0,n.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),l||b?"...":y?"Modifier":"Cr\xe9er"]}),y&&(0,n.jsxs)(c.z,{type:"button",variant:"destructive",onClick:e=>{e.preventDefault(),e.stopPropagation(),N&&N()},disabled:j,className:"flex items-center justify-center",children:[(0,n.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),j?"...":"Supprimer"]})]})]})})]}),(0,n.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2 -bottom-2",children:(0,n.jsx)("div",{className:"w-0 h-0 border-l-[12px] border-r-[12px] border-t-[12px] border-l-transparent border-r-transparent border-t-white drop-shadow-sm"})})]})}function j(e){let{onCoordinatesChange:r,onLocationEdit:o,locations:i=[],form:c,onSubmit:d,onCancel:u,isCreating:m=!1,editingLocation:f,isCreateLoading:x=!1,isUpdateLoading:p=!1,isDeleteLoading:h=!1,onDelete:g}=e,v=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),y=(0,a.useRef)([]),w=(0,a.useRef)(null),k=async(e,r)=>{try{let t=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(r,"&zoom=18&addressdetails=1")),n=await t.json();if(n.display_name){let e=n.address||{};return e.road&&e.city?"".concat(e.road,", ").concat(e.city):n.display_name.split(",").slice(0,2).join(",").trim()}return"".concat(e.toFixed(4),", ").concat(r.toFixed(4))}catch(t){return console.error("Error getting location name:",t),"".concat(e.toFixed(4),", ").concat(r.toFixed(4))}},z=(0,a.useCallback)((e,r,t,a)=>{let i=document.createElement("div");i.className="location-marker-container";let c=(0,s.createRoot)(i);c.render((0,n.jsx)(l,{locationName:a.name||a.address||"Lieu sans nom",address:a.address,latitude:r,longitude:t,onClick:()=>{o&&o(a)}}));let d=e.divIcon({html:i,className:"location-marker-icon",iconSize:[220,50],iconAnchor:[110,85]}),u=e.marker([r,t],{icon:d});return u.on("click",r=>{e.DomEvent.stopPropagation(r)}),u._reactRoot=c,u},[o]),R=e=>{if(e&&e._reactRoot){let r=e._reactRoot;setTimeout(()=>{try{r.unmount()}catch(e){console.warn("Error unmounting marker root:",e)}},0)}j.current&&e&&j.current.removeLayer(e)};return(0,a.useEffect)(()=>{if(!v.current||j.current)return;let e=v.current;return(async()=>{let a=await t.e(4212).then(t.t.bind(t,60759,23));if(e._leaflet_id){console.warn("Map container already has a Leaflet instance, skipping initialization");return}j.current=a.map(e).setView([45.782871,4.769279],13),a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(j.current),j.current.on("click",async e=>{let{lat:t,lng:o}=e.latlng;if(N.current&&(R(N.current),N.current=null),!f){let e=await k(t,o);r(t,o,e);let i=document.createElement("div");i.className="add-marker-container";let l=(0,s.createRoot)(i);l.render((0,n.jsx)(b,{isAdded:!1,address:e,form:c,onSubmit:d||(()=>{}),onCancel:()=>{N.current&&(R(N.current),N.current=null),u&&u()},isCreateLoading:x,isUpdateLoading:p,isDeleteLoading:h,editingLocation:null}));let m=a.divIcon({html:i,className:"add-marker-icon",iconSize:[400,380],iconAnchor:[200,435]});N.current=a.marker([t,o],{icon:m}),N.current.on("click",e=>{a.DomEvent.stopPropagation(e)}),N.current._reactRoot=l,N.current.addTo(j.current);let f=j.current.getZoom(),g=256*Math.pow(2,f)/360;j.current.setView([t+160/g,o],f,{animate:!0,duration:.5})}}),i.forEach(e=>{if(e.latitude&&e.longitude&&(!f||f.id!==e.id)){let r=z(a,e.latitude,e.longitude,e);j.current&&(r.addTo(j.current),y.current.push(r))}})})().catch(console.error),()=>{j.current&&(N.current&&R(N.current),w.current&&R(w.current),y.current.forEach(R),j.current.remove(),j.current=null,N.current=null,w.current=null,y.current=[],delete e._leaflet_id)}},[]),(0,a.useEffect)(()=>{j.current&&i&&(async()=>{if(await new Promise(e=>setTimeout(e,50)),!j.current)return;let e=await t.e(4212).then(t.t.bind(t,60759,23));y.current.forEach(R),y.current=[],i.forEach(r=>{if(r.latitude&&r.longitude&&(!f||f.id!==r.id)){let t=z(e,r.latitude,r.longitude,r);j.current&&(t.addTo(j.current),y.current.push(t))}})})().catch(console.error)},[i,f,z]),(0,a.useEffect)(()=>{j.current&&(async()=>{let e=await t.e(4212).then(t.t.bind(t,60759,23));if(w.current&&(R(w.current),w.current=null),N.current&&(R(N.current),N.current=null),f&&f.latitude&&f.longitude){let r=f.name||f.address||"Lieu sans nom",t=document.createElement("div");t.className="edit-marker-container";let a=(0,s.createRoot)(t);a.render((0,n.jsx)(b,{isAdded:!0,address:f.address||r,form:c,onSubmit:d||(()=>{}),onCancel:()=>{w.current&&(R(w.current),w.current=null),u&&u()},isCreateLoading:x,isUpdateLoading:p,isDeleteLoading:h,onDelete:g?()=>g(f.id):void 0,editingLocation:f}));let o=e.divIcon({html:t,className:"edit-marker-icon",iconSize:[400,380],iconAnchor:[200,435]});if(w.current=e.marker([f.latitude,f.longitude],{icon:o}),w.current.on("click",r=>{e.DomEvent.stopPropagation(r)}),w.current._reactRoot=a,j.current){w.current.addTo(j.current);let e=j.current.getZoom(),r=256*Math.pow(2,e)/360;j.current.setView([f.latitude+160/r,f.longitude],e,{animate:!0,duration:.5})}}})().catch(console.error)},[f]),(0,a.useEffect)(()=>{j.current&&!m&&N.current&&(R(N.current),N.current=null)},[m]),(0,n.jsx)("div",{ref:v,className:"h-full w-full rounded-md border border-input overflow-hidden",style:{zIndex:0}})}},69174:function(e,r,t){"use strict";t.d(r,{C:function(){return i}});var n=t(57437);t(2265);var a=t(90535),s=t(94508);let o=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:r,variant:t,...a}=e;return(0,n.jsx)("div",{className:(0,s.cn)(o({variant:t}),r),...a})}},80670:function(e,r,t){"use strict";t.d(r,{NI:function(){return h},Wi:function(){return u},l0:function(){return l},lX:function(){return p},pf:function(){return g},xJ:function(){return x},zG:function(){return v}});var n=t(57437),a=t(2265),s=t(37053),o=t(29501),i=t(94508),c=t(75060);let l=o.RV,d=a.createContext({}),u=e=>{let{...r}=e;return(0,n.jsx)(d.Provider,{value:{name:r.name},children:(0,n.jsx)(o.Qr,{...r})})},m=()=>{let e=a.useContext(d),r=a.useContext(f),{getFieldState:t,formState:n}=(0,o.Gc)(),s=t(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=r;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...s}},f=a.createContext({}),x=a.forwardRef((e,r)=>{let{className:t,...s}=e,o=a.useId();return(0,n.jsx)(f.Provider,{value:{id:o},children:(0,n.jsx)("div",{ref:r,className:(0,i.cn)("space-y-2",t),...s})})});x.displayName="FormItem";let p=a.forwardRef((e,r)=>{let{className:t,...a}=e,{error:s,formItemId:o}=m();return(0,n.jsx)(c._,{ref:r,className:(0,i.cn)(s&&"text-destructive",t),htmlFor:o,...a})});p.displayName="FormLabel";let h=a.forwardRef((e,r)=>{let{...t}=e,{error:a,formItemId:o,formDescriptionId:i,formMessageId:c}=m();return(0,n.jsx)(s.g7,{ref:r,id:o,"aria-describedby":a?"".concat(i," ").concat(c):"".concat(i),"aria-invalid":!!a,...t})});h.displayName="FormControl";let g=a.forwardRef((e,r)=>{let{className:t,...a}=e,{formDescriptionId:s}=m();return(0,n.jsx)("p",{ref:r,id:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});g.displayName="FormDescription";let v=a.forwardRef((e,r)=>{let{className:t,children:a,...s}=e,{error:o,formMessageId:c}=m(),l=o?String(null==o?void 0:o.message):a;return l?(0,n.jsx)("p",{ref:r,id:c,className:(0,i.cn)("text-sm font-medium text-destructive",t),...s,children:l}):null});v.displayName="FormMessage"},40279:function(e,r,t){"use strict";t.d(r,{I:function(){return o}});var n=t(57437),a=t(2265),s=t(94508);let o=a.forwardRef((e,r)=>{let{className:t,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...o})});o.displayName="Input"},75060:function(e,r,t){"use strict";t.d(r,{_:function(){return l}});var n=t(57437),a=t(2265),s=t(6394),o=t(90535),i=t(94508);let c=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,n.jsx)(s.f,{ref:r,className:(0,i.cn)(c(),t),...a})});l.displayName=s.f.displayName},31593:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(57437),a=t(2265),s=t(55156),o=t(94508);let i=a.forwardRef((e,r)=>{let{className:t,orientation:a="horizontal",decorative:i=!0,...c}=e;return(0,n.jsx)(s.f,{ref:r,decorative:i,orientation:a,className:(0,o.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...c})});i.displayName=s.f.displayName},23675:function(e,r,t){"use strict";t.d(r,{g:function(){return o}});var n=t(57437),a=t(2265),s=t(94508);let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,n.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...a})});o.displayName="Textarea"},35046:function(){},6394:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var n=t(2265),a=t(66840),s=t(57437),o=n.forwardRef((e,r)=>(0,s.jsx)(a.WV.label,{...e,ref:r,onMouseDown:r=>{var t;r.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));o.displayName="Label";var i=o},55156:function(e,r,t){"use strict";t.d(r,{f:function(){return l}});var n=t(2265),a=t(66840),s=t(57437),o="horizontal",i=["horizontal","vertical"],c=n.forwardRef((e,r)=>{let{decorative:t,orientation:n=o,...c}=e,l=i.includes(n)?n:o;return(0,s.jsx)(a.WV.div,{"data-orientation":l,...t?{role:"none"}:{"aria-orientation":"vertical"===l?l:void 0,role:"separator"},...c,ref:r})});c.displayName="Separator";var l=c}}]);